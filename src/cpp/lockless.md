# CAS

CAS机制是指一种数据更新的方式，通常用于实现多线程环境下的原子操作。在具体讲什么是CAS机制之前，我们先来聊下在多线程环境下，对共享变量进行数据更新的两种模式：悲观锁模式和乐观锁模式。CAS机制属于乐观锁的典型实现。它通过比较并交换（Compare And Swap）的方式，保证在不使用锁的情况下，对共享变量的操作具有原子性，以此避免多线程竞争带来的数据不一致问题。CAS操作需要三个操作数：内存位置（V）、预期原值（A）和新值（B），

1. 读取内存位置 V 的当前值。

2. 把当前值和预期原值 A 进行比较。

3. 若当前值和预期原值 A 相等，就把内存位置 V 的值更新为新值 B；反之，则不做更新。

CAS机制的优点在于它能够实现无锁编程，避免了锁带来的线程阻塞问题，从而提高了程序的并发性能。然而，它也存在一些问题，比如ABA问题，即如果一个变量从A变到B，再变回A，CAS机制可能会认为这个变量没有被修改过，从而导致错误的结果。为了解决这个问题，可以引入版本号或时间戳来确保CAS操作的正确性。

# ABA问题

一个线程，先把数据从A改为B在改为A，就是ABA问题。

## Tagged state reference

通过添加一个版本号，
